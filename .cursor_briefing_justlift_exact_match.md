# Just Lift Screen - Exact Kotlin Match

**Task:** Rewrite Flutter JustLiftScreen to exactly match Kotlin JustLiftScreen.kt

**Source Analysis:** JUSTLIFT_ANALYSIS.md (comprehensive analysis)

## Current Flutter Implementation Problems

❌ Has AppBar (Kotlin has minimal/no AppBar or custom toolbar)
❌ No gradient background
❌ Missing mode selection (Old School, Pump, Echo)
❌ Missing weight per cable configuration
❌ Missing weight change per rep (progression/regression)
❌ Missing Echo mode configuration (eccentric load slider, echo level chips)
❌ Simple idle view (should show configuration cards)
❌ Position indicators in center (should be on edges like Active Workout)
❌ Missing active status card with stop button
❌ Basic layout (should be scrollable column with cards)

## Required Changes

### 1. Gradient Background (Same as Active Workout & Home)

```dart
Container(
  decoration: BoxDecoration(
    gradient: LinearGradient(
      begin: Alignment.topCenter,
      end: Alignment.bottomCenter,
      colors: isDark
        ? [Color(0xFF0F172A), Color(0xFF1E1B4B), Color(0xFF172554)] // Slate→Indigo→Blue
        : [Color(0xFFE0E7FF), Color(0xFFFCE7F3), Color(0xFFDDD6FE)], // Indigo→Pink→Violet
    ),
  ),
  child: SafeArea(...),
)
```

### 2. Replace AppBar with Custom Toolbar (Optional)

Kotlin uses minimal AppBar. Flutter can either:
- Keep simple AppBar (easiest)
- Use custom Row with back button and title
- Remove AppBar entirely and rely on gradient background

**Recommendation:** Keep AppBar for consistency with Flutter navigation patterns.

### 3. Create Mode Selection Card Widget

**File:** `lib/presentation/widgets/workout/mode_selection_card.dart` (new)

```dart
class ModeSelectionCard extends StatelessWidget {
  final WorkoutMode selectedMode; // Old School, Pump, Echo
  final ValueChanged<WorkoutMode> onModeChanged;

  // Card with:
  // - Title: "Workout Mode" (titleMedium, Bold)
  // - Row of 3 FilterChips:
  //   1. "Old School" + check icon when selected
  //   2. "Pump" + check icon when selected
  //   3. "Echo" + check icon when selected
  // - Description text below (mode-specific)
  // - Spring animation on tap (scale 0.99f)
  // - Elevation change 4dp → 2dp on press
}
```

**Descriptions:**
- Old School: "Constant resistance throughout the movement."
- Pump: "Resistance increases the faster you go."
- Echo: "Adaptive resistance with echo feedback."

### 4. Create Compact Number Picker Widget

**File:** `lib/presentation/widgets/inputs/compact_number_picker.dart` (new)

```dart
class CompactNumberPicker extends StatelessWidget {
  final String label;
  final int value;
  final int min;
  final int max;
  final String suffix; // "kg", "lbs"
  final ValueChanged<int> onChanged;

  // Compact picker with:
  // - Label text (titleMedium)
  // - Row: [-] button, value display, [+] button
  // - Suffix after value
  // - IconButtons for increment/decrement
  // - Disabled state when at min/max
}
```

### 5. Create Weight Configuration Cards

**Weight per Cable Card:**
```dart
CompactNumberPicker(
  label: "Weight per Cable",
  value: weightPerCable,
  min: weightUnit == WeightUnit.KG ? 1 : 1,
  max: weightUnit == WeightUnit.KG ? 100 : 220,
  suffix: weightUnit == WeightUnit.KG ? "kg" : "lbs",
  onChanged: (value) => onWeightChanged(value),
)
```

**Weight Change per Rep Card:**
```dart
Column(
  children: [
    CompactNumberPicker(
      label: "Weight Change Per Rep",
      value: weightChangePerRep,
      min: -10,
      max: 10,
      suffix: weightUnit == WeightUnit.KG ? "kg" : "lbs",
      onChanged: (value) => onWeightChangeChanged(value),
    ),
    SizedBox(height: 8),
    Text(
      "Negative = Regression, Positive = Progression",
      style: bodySmall,
      color: onSurfaceVariant,
    ),
  ],
)
```

### 6. Create Echo Mode Configuration Cards

**Eccentric Load Card:**
```dart
Card(
  child: Padding(
    padding: EdgeInsets.all(16),
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text("Eccentric Load: $eccentricLoad%", style: titleMedium.bold),
        SizedBox(height: 8),
        Slider(
          value: eccentricLoad / 50, // 0-3 (6 discrete values)
          min: 0,
          max: 3,
          divisions: 5, // 6 values: 0%, 50%, 75%, 100%, 125%, 150%
          label: "$eccentricLoad%",
          onChanged: (value) {
            // Map to: 0, 50, 75, 100, 125, 150
            final values = [0, 50, 75, 100, 125, 150];
            final index = (value * 5 / 3).round();
            onEccentricLoadChanged(values[index]);
          },
        ),
        Text(
          "Load percentage applied during eccentric (lowering) phase",
          style: bodySmall,
          color: onSurfaceVariant,
        ),
      ],
    ),
  ),
)
```

**Echo Level Card:**
```dart
Card(
  child: Padding(
    padding: EdgeInsets.all(16),
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text("Echo Level", style: titleMedium.bold),
        SizedBox(height: 8),
        Row(
          children: [
            _buildEchoLevelChip("Hard", EchoLevel.hard),
            SizedBox(width: 8),
            _buildEchoLevelChip("Harder", EchoLevel.harder),
            SizedBox(width: 8),
            _buildEchoLevelChip("Hardest", EchoLevel.hardest),
            SizedBox(width: 8),
            _buildEchoLevelChip("Epic", EchoLevel.epic),
          ],
        ),
      ],
    ),
  ),
)

Widget _buildEchoLevelChip(String label, EchoLevel level) {
  return Expanded(
    child: FilterChip(
      label: Text(label, maxLines: 1),
      selected: selectedEchoLevel == level,
      onSelected: (selected) => onEchoLevelChanged(level),
      showCheckmark: true,
    ),
  );
}
```

### 7. Create Active Status Card

**File:** `lib/presentation/widgets/workout/active_status_card.dart` (new)

```dart
class ActiveStatusCard extends StatelessWidget {
  final WorkoutState workoutState;
  final int totalReps;
  final double currentLoad; // total load (both cables)
  final WeightUnit weightUnit;
  final VoidCallback onStop;

  // Card with:
  // - primaryContainer background
  // - Dynamic title based on workoutState:
  //   * Countdown: "Get Ready: {X}s"
  //   * Active: "Workout Active"
  //   * Resting: "Resting: {X}s"
  //   * Completed: "Workout Complete"
  // - Reps display: "Reps: {totalReps}" (bodyLarge)
  // - Load display: "Load: {formatted weight}" (bodyMedium)
  // - Stop button: OutlinedButton with error color, Close icon + "Stop Workout"
}
```

### 8. Main Layout Structure

```dart
Container(
  decoration: BoxDecoration(gradient: gradient),
  child: Scaffold(
    backgroundColor: Colors.transparent,
    appBar: AppBar(
      title: Text('Just Lift'),
      backgroundColor: Colors.transparent,
      elevation: 0,
    ),
    body: Stack(
      children: [
        // Edge position bars (only when workout active)
        if (showPositionBars)
          Positioned(
            left: 0,
            top: 0,
            bottom: 0,
            width: 40,
            child: CablePositionIndicator(label: 'L', ...),
          ),

        // Center content (scrollable)
        Positioned(
          left: showPositionBars ? 56 : 0,
          right: showPositionBars ? 56 : 0,
          top: 0,
          bottom: 0,
          child: SingleChildScrollView(
            padding: EdgeInsets.all(24),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.stretch,
              children: [
                // Auto-start/stop indicator card
                AutoStartStopCard(
                  workoutState: workoutState,
                  autoStartCountdown: autoStartCountdown,
                  autoStopState: autoStopState,
                ),

                SizedBox(height: 16),

                // Mode selection
                ModeSelectionCard(
                  selectedMode: selectedMode,
                  onModeChanged: onModeChanged,
                ),

                SizedBox(height: 16),

                // Conditional: Old School / Pump
                if (selectedMode == WorkoutMode.oldSchool ||
                    selectedMode == WorkoutMode.pump) ...[
                  CompactNumberPicker(
                    label: "Weight per Cable",
                    value: weightPerCable,
                    min: weightUnit == WeightUnit.kg ? 1 : 1,
                    max: weightUnit == WeightUnit.kg ? 100 : 220,
                    suffix: weightUnit.name.toLowerCase(),
                    onChanged: onWeightChanged,
                  ),
                  SizedBox(height: 16),
                  Column(
                    children: [
                      CompactNumberPicker(
                        label: "Weight Change Per Rep",
                        value: weightChangePerRep,
                        min: -10,
                        max: 10,
                        suffix: weightUnit.name.toLowerCase(),
                        onChanged: onWeightChangeChanged,
                      ),
                      SizedBox(height: 8),
                      Text(
                        "Negative = Regression, Positive = Progression",
                        style: bodySmall,
                      ),
                    ],
                  ),
                ],

                // Conditional: Echo
                if (selectedMode == WorkoutMode.echo) ...[
                  EccentricLoadCard(
                    eccentricLoad: eccentricLoad,
                    onChanged: onEccentricLoadChanged,
                  ),
                  SizedBox(height: 16),
                  EchoLevelCard(
                    selectedLevel: echoLevel,
                    onChanged: onEchoLevelChanged,
                  ),
                ],

                // Conditional: Workout active
                if (workoutState is Active ||
                    workoutState is Countdown ||
                    workoutState is Resting) ...[
                  SizedBox(height: 16),
                  Divider(),
                  SizedBox(height: 16),
                  ActiveStatusCard(
                    workoutState: workoutState,
                    totalReps: totalReps,
                    currentLoad: currentLoad,
                    weightUnit: weightUnit,
                    onStop: onStopWorkout,
                  ),
                ],
              ],
            ),
          ),
        ),

        // Right position bar (only when workout active)
        if (showPositionBars)
          Positioned(
            right: 0,
            top: 0,
            bottom: 0,
            width: 40,
            child: CablePositionIndicator(label: 'R', ...),
          ),
      ],
    ),
  ),
)
```

### 9. Auto-Start/Stop Card Integration

The AutoStartStopCard widget already exists. Update it to match Kotlin specs:

**States:**
- Idle (no countdown): "Auto-Start Ready" + "Grab and hold handles briefly (~1s) to start"
- Auto-start countdown: "Starting..." + indeterminate progress bar
- Active (no countdown): "Auto-Stop Ready" + "Put handles down for 3 seconds to stop"
- Auto-stop countdown: "Stopping in {X}s..." + determinate progress bar (0-100%)

**Icons:**
- Idle: PlayCircle (32dp)
- Active: PanTool (32dp)

**Progress Bar:**
- Height: 8dp
- Auto-start: indeterminate (smooth feel)
- Auto-stop: determinate with progress value

### 10. State Management

Need to track Just Lift specific parameters in WorkoutSessionProvider:
- `selectedMode`: WorkoutMode (oldSchool, pump, echo)
- `weightPerCable`: int (1-100 kg or 1-220 lbs)
- `weightChangePerRep`: int (-10 to +10)
- `eccentricLoad`: int (0, 50, 75, 100, 125, 150)
- `echoLevel`: EchoLevel (hard, harder, hardest, epic)

These should be part of WorkoutParameters in the state.

### 11. Navigation Flow

- User configures workout (mode, weight, progression)
- Grabs handles → Auto-start countdown (3s) → Active state
- Puts handles down for 3s → Auto-stop countdown → Returns to Idle
- NO summary screen in Just Lift mode (special behavior)
- Stop button manually ends workout → Returns to Idle

## Implementation Checklist

- [ ] Remove/update AppBar to match Kotlin (or keep for Flutter patterns)
- [ ] Add gradient background (same as Active Workout & Home)
- [ ] Create ModeSelectionCard widget (3 FilterChips)
- [ ] Create CompactNumberPicker widget
- [ ] Create EccentricLoadCard widget (Slider)
- [ ] Create EchoLevelCard widget (4 FilterChips)
- [ ] Create ActiveStatusCard widget
- [ ] Implement Stack layout with edge position bars
- [ ] Update main column with scrollable configuration cards
- [ ] Conditional rendering based on selectedMode
- [ ] Integrate AutoStartStopCard with proper states
- [ ] Add HorizontalDivider before active status card
- [ ] Connect state to WorkoutSessionProvider
- [ ] Test mode switching (Old School → Pump → Echo)
- [ ] Test weight unit conversion (kg ↔ lbs)
- [ ] Test progression/regression range (-10 to +10)
- [ ] Test eccentric load slider (6 discrete values)
- [ ] Test echo level chips
- [ ] Run flutter analyze

## Spacing & Styling

- **Card padding:** 16dp
- **Column spacing:** 16dp between cards
- **Main padding:** 24dp (scrollable content)
- **Position bars:** 40dp width, 56dp margins when active
- **Typography:**
  - Titles: titleMedium, Bold
  - Body: bodySmall, bodyMedium
  - Button: labelLarge
- **Colors:** Material 3 theme (surface, primaryContainer, onSurface, onSurfaceVariant)

## Verification

After implementation:
- ✅ Gradient background matches Kotlin
- ✅ Mode selection with 3 chips
- ✅ Weight per cable picker (Old School/Pump)
- ✅ Weight change per rep picker (Old School/Pump)
- ✅ Eccentric load slider (Echo, 6 values)
- ✅ Echo level chips (Echo, 4 levels)
- ✅ Auto-start/stop card with progress bars
- ✅ Active status card with reps, load, stop button
- ✅ Edge position bars when active
- ✅ Scrollable configuration
- ✅ Conditional rendering based on mode
- ✅ No errors in flutter analyze
