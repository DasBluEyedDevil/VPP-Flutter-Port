# Widget Integration Task - Active Workout & Just Lift Screens

**Date:** 2025-11-12
**Task:** Integrate CablePositionIndicator and AutoStartStopCard into workout screens
**Delegated To:** Cursor CLI
**Priority:** HIGH (completes Phase 5 UI polish)

---

## Context

We have created 2 new widgets that need to be integrated into the existing workout screens:

1. **CablePositionIndicator** (157 lines) - Vertical bars showing cable positions (0-1000)
2. **AutoStartStopCard** (105 lines) - Unified countdown card for Just Lift mode

These widgets were created based on the Kotlin source and need to be added to:
- `lib/presentation/screens/active_workout_screen.dart` (needs CablePositionIndicator)
- `lib/presentation/screens/just_lift_screen.dart` (needs both widgets)

---

## Widget 1: CablePositionIndicator

**File:** `lib/presentation/widgets/workout/cable_position_indicator.dart`

**Purpose:** Display real-time cable position as vertical bars during workouts

**Constructor:**
```dart
class CablePositionIndicator extends StatelessWidget {
  final double position;        // 0.0 to 1.0
  final String label;          // "L" or "R"
  final bool isActive;         // Whether actively showing position
  final double? minRange;      // Optional min range marker
  final double? maxRange;      // Optional max range marker

  const CablePositionIndicator({
    super.key,
    required this.position,
    required this.label,
    this.isActive = true,
    this.minRange,
    this.maxRange,
  });
}
```

**Visual Design:**
- Width: 40dp vertical bar
- Position fills from bottom to top (0.0 = empty, 1.0 = full)
- Active: primary color fill
- Inactive: surfaceContainerHighest with reduced opacity
- Optional colored zone between minRange and maxRange

**Where to Integrate:**
1. **ActiveWorkoutScreen** - During active workout state
2. **JustLiftScreen** - During active lifting

**Data Source:**
- Left cable position: `workoutState.currentMetrics?.leftPosition ?? 0`
- Right cable position: `workoutState.currentMetrics?.rightPosition ?? 0`
- Normalize from 0-1000 raw value to 0.0-1.0 for display: `position / 1000.0`

**Placement Guidelines (from Kotlin WorkoutTab.kt):**
- Place side-by-side (Row) showing both left and right cables
- Position at top of workout content area
- Horizontal spacing: 16dp between bars
- Labels: "L" and "R"

---

## Widget 2: AutoStartStopCard

**File:** `lib/presentation/widgets/workout/auto_start_stop_card.dart`

**Purpose:** Show countdown and state for auto-start/auto-stop in Just Lift mode

**Constructor:**
```dart
enum AutoStartStopState {
  inactive,    // Not active
  autoStart,   // Counting down to start
  autoStop,    // Counting down to stop
  ready,       // Ready to begin
}

class AutoStartStopCard extends StatelessWidget {
  final int secondsRemaining;
  final AutoStartStopState state;

  const AutoStartStopCard({
    super.key,
    required this.secondsRemaining,
    required this.state,
  });
}
```

**Visual Design:**
- Card-based layout with icon, countdown, and state text
- State-based colors:
  - `inactive`: surfaceVariant
  - `autoStart`: primaryContainer (green/positive)
  - `autoStop`: errorContainer (red/warning)
  - `ready`: tertiaryContainer (blue/info)
- Large countdown number (displayLarge style)
- Icon changes per state

**Where to Integrate:**
- **JustLiftScreen** - Replace existing countdown displays with this unified card

**Data Source:**
- Auto-start countdown: `justLiftState.autoStartCountdown`
- Auto-stop countdown: `justLiftState.autoStopCountdown`
- Current state: Derive from `justLiftState.isAutoStartActive` and `justLiftState.isAutoStopActive`

---

## Task Requirements

### Task 1: Integrate CablePositionIndicator into ActiveWorkoutScreen

**File:** `lib/presentation/screens/active_workout_screen.dart`

**Instructions:**
1. Import CablePositionIndicator widget
2. Find the `_ActiveView` widget (active workout display)
3. Add position indicators at the top of the workout content
4. Layout:
   ```dart
   Row(
     mainAxisAlignment: MainAxisAlignment.center,
     children: [
       CablePositionIndicator(
         position: (state.currentMetrics?.leftPosition ?? 0) / 1000.0,
         label: 'L',
         isActive: true,
       ),
       const SizedBox(width: 16),
       CablePositionIndicator(
         position: (state.currentMetrics?.rightPosition ?? 0) / 1000.0,
         label: 'R',
         isActive: true,
       ),
     ],
   )
   ```
5. Ensure position updates in real-time as metrics change

### Task 2: Integrate Both Widgets into JustLiftScreen

**File:** `lib/presentation/screens/just_lift_screen.dart`

**Instructions:**

#### 2a. Add CablePositionIndicator
1. Import CablePositionIndicator widget
2. Find the `_ActiveView` widget (active lifting display)
3. Add position indicators similar to ActiveWorkoutScreen
4. Use same data source: `justLiftState.currentMetrics?.leftPosition` and `rightPosition`

#### 2b. Replace countdown displays with AutoStartStopCard
1. Import AutoStartStopCard widget
2. Find the auto-start countdown display (typically shows "Auto-starting in X seconds")
3. Replace with:
   ```dart
   AutoStartStopCard(
     secondsRemaining: justLiftState.autoStartCountdown,
     state: AutoStartStopState.autoStart,
   )
   ```
4. Find the auto-stop countdown display (typically shows "Auto-stopping in X seconds")
5. Replace with:
   ```dart
   AutoStartStopCard(
     secondsRemaining: justLiftState.autoStopCountdown,
     state: AutoStartStopState.autoStop,
   )
   ```
6. Use conditional logic to determine which card to show based on state

---

## Verification Steps

After integration, verify:

1. **flutter analyze** - Should have 0 new errors
2. **Visual verification** (if possible):
   - ActiveWorkoutScreen shows cable positions during workout
   - JustLiftScreen shows cable positions during lifting
   - AutoStartStopCard appears with correct colors and countdown
3. **State updates** - Position bars should update as metrics change
4. **Null safety** - Handle cases where currentMetrics is null

---

## Additional Notes

- Both screens already have working BLE state management through Riverpod
- currentMetrics is available via `workoutState.currentMetrics` or `justLiftState.currentMetrics`
- Cable positions are raw values 0-1000, normalize to 0.0-1.0 for display
- AutoStartStopCard replaces existing text-based countdown displays
- These are the final UI polish items for Phase 5

---

## Expected Outcome

After completion:
- ✅ ActiveWorkoutScreen displays real-time cable positions
- ✅ JustLiftScreen displays real-time cable positions
- ✅ JustLiftScreen uses unified AutoStartStopCard for countdowns
- ✅ flutter analyze reports 0 new errors
- ✅ App builds successfully

---

## Reference Files

**New Widgets:**
- `lib/presentation/widgets/workout/cable_position_indicator.dart`
- `lib/presentation/widgets/workout/auto_start_stop_card.dart`

**Target Screens:**
- `lib/presentation/screens/active_workout_screen.dart`
- `lib/presentation/screens/just_lift_screen.dart`

**Kotlin Reference:**
- `C:\Users\dasbl\AndroidStudioProjects\VitruvianRedux\app\src\main\java\com\example\vitruvianredux\presentation\screen\WorkoutTab.kt` (lines 450-520 for position indicators)
- `C:\Users\dasbl\AndroidStudioProjects\VitruvianRedux\app\src\main\java\com\example\vitruvianredux\presentation\screen\JustLiftScreen.kt` (lines 280-350 for auto-start/stop cards)

---

**End of Briefing**
